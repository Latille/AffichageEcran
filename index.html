<div id="sms-section" class="notif-section" style="display:none;">
                <div class="search-bar">
                    <input type="text" id="sms-search" placeholder="Rechercher un num√©ro...">
                </div>
                
                <div class="contacts-list">
                    <div class="empty-state">
                        Aucun contact SMS configur√©
                    </div>
                </div>
            </div>

            <div id="settings-section" class="notif-section" style="display:none;">
                <div class="settings-card">
                    <h4>‚öôÔ∏è Param√®tres de notification</h4>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h5>Notifications d'expiration</h5>
                            <p>Alerter 24h avant expiration</p>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <h5>Cr√©ations d'affiches</h5>
                            <p>Notifier √† chaque cr√©ation</p>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <h5>Mises en diffusion</h5>
                            <p>Notifier lors du d√©marrage</p>
                        </div>
                        <label class="toggle">
                            <input type="checkbox">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <h5>R√©sum√© quotidien</h5>
                            <p>Envoi √† 08h00 chaque jour</p>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-card">
                    <h4>üìß Serveur SMTP</h4>
                    <div class="form-group">
                        <label>Serveur</label>
                        <input type="text" value="smtp.gmail.com" placeholder="smtp.exemple.com">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Port</label>
                            <input type="number" value="587" placeholder="587">
                        </div>
                        <div class="form-group">
                            <label>S√©curit√©</label>
                            <select>
                                <option value="tls">TLS</option>
                                <option value="ssl">SSL</option>
                                <option value="none">Aucune</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Email exp√©diteur</label>
                        <input type="email" value="affichage@monmagasin.fr" placeholder="votre@email.com">
                    </div>
                    <button class="btn" style="margin-top: 15px;">üíæ Sauvegarder</button>
                </div>
            </div>

            <button class="fab" onclick="openContactModal()">+</button>
        </div>

        <button class="fab" onclick="openModal()">+</button>
    </div>

    <!-- Modal de cr√©ation d'affiche -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìù Nouvelle affiche</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            
            <form id="createForm">
                <div class="form-group">
                    <label for="libelle">Libell√© *</label>
                    <input type="text" id="libelle" name="libelle" placeholder="Ex: Pommes Golden" required>
                </div>

                <div class="form-group">
                    <label for="famille">Famille *</label>
                    <select id="famille" name="famille" required>
                        <option value="">Choisir une famille</option>
                        <option value="fruits-legumes">üçé Fruits & l√©gumes</option>
                        <option value="traiteur">ü•ò Traiteur</option>
                        <option value="boucherie">ü•© Boucherie</option>
                        <option value="cremerie">üßÄ Cr√©merie</option>
                        <option value="epicerie">üõí Epicerie</option>
                        <option value="boulangerie">ü•ñ Boulangerie</option>
                        <option value="autre">üì¶ Autre</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="dateDebut">D√©but *</label>
                        <input type="date" id="dateDebut" name="dateDebut" required>
                    </div>
                    <div class="form-group">
                        <label for="dateFin">Fin *</label>
                        <input type="date" id="dateFin" name="dateFin" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="prix">Prix *</label>
                        <input type="number" id="prix" name="prix" step="0.01" placeholder="0.00" required>
                    </div>
                    <div class="form-group">
                        <label for="unite">Unit√© *</label>
                        <select id="unite" name="unite" required>
                            <option value="kg">Kg</option>
                            <option value="unite">Unit√©</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="origine">Origine *</label>
                    <input type="text" id="origine" name="origine" placeholder="Ex: France, Local" required>
                </div>

                <button type="submit" class="btn">‚úÖ Cr√©er l'affiche</button>
            </form>
        </div>
    </div>

    <!-- Modal d'√©dition d'affiche -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Modifier l'affiche</h3>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            
            <form id="editForm">
                <input type="hidden" id="editAfficheId" name="editAfficheId">
                
                <div class="form-group">
                    <label for="editLibelle">Libell√© *</label>
                    <input type="text" id="editLibelle" name="editLibelle" placeholder="Ex: Pommes Golden" required>
                </div>

                <div class="form-group">
                    <label for="editFamille">Famille *</label>
                    <select id="editFamille" name="editFamille" required>
                        <option value="">Choisir une famille</option>
                        <option value="fruits-legumes">üçé Fruits & l√©gumes</option>
                        <option value="traiteur">ü•ò Traiteur</option>
                        <option value="boucherie">ü•© Boucherie</option>
                        <option value="cremerie">üßÄ Cr√©merie</option>
                        <option value="epicerie">üõí Epicerie</option>
                        <option value="boulangerie">ü•ñ Boulangerie</option>
                        <option value="autre">üì¶ Autre</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editDateDebut">D√©but *</label>
                        <input type="date" id="editDateDebut" name="editDateDebut" required>
                    </div>
                    <div class="form-group">
                        <label for="editDateFin">Fin *</label>
                        <input type="date" id="editDateFin" name="editDateFin" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editPrix">Prix *</label>
                        <input type="number" id="editPrix" name="editPrix" step="0.01" placeholder="0.00" required>
                    </div>
                    <div class="form-group">
                        <label for="editUnite">Unit√© *</label>
                        <select id="editUnite" name="editUnite" required>
                            <option value="kg">Kg</option>
                            <option value="unite">Unit√©</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="editOrigine">Origine *</label>
                    <input type="text" id="editOrigine" name="editOrigine" placeholder="Ex: France, Local" required>
                </div>

                <div class="form-group">
                    <label for="editStatut">Statut *</label>
                    <select id="editStatut" name="editStatut" required>
                        <option value="a-creer">√Ä cr√©er</option>
                        <option value="programmee">Programm√©e</option>
                        <option value="en-diffusion">En diffusion</option>
                        <option value="archivee">Archiv√©e</option>
                    </select>
                </div>

                <button type="submit" class="btn">üíæ Sauvegarder</button>
            </form>
        </div>
    </div>

    <!-- Modal d'√©dition de contact -->
    <div id="editContactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Modifier le contact</h3>
                <span class="close" onclick="closeEditContactModal()">&times;</span>
            </div>
            
            <form id="editContactForm">
                <input type="hidden" id="editContactId" name="editContactId">
                <input type="hidden" id="editContactType" name="editContactType">

                <div class="form-group">
                    <label for="editContactName">Nom complet</label>
                    <input type="text" id="editContactName" name="editContactName" placeholder="Ex: Sophie Martin" required>
                </div>

                <div class="form-group" id="editEmailField">
                    <label for="editContactEmail">Adresse email</label>
                    <input type="email" id="editContactEmail" name="editContactEmail" placeholder="sophie.martin@exemple.fr">
                </div>

                <div class="form-group" id="editSmsField" style="display:none;">
                    <label for="editContactPhone">Num√©ro de t√©l√©phone</label>
                    <input type="tel" id="editContactPhone" name="editContactPhone" placeholder="+33 6 12 34 56 78">
                </div>

                <div class="form-group">
                    <label for="editContactRole">R√¥le</label>
                    <select id="editContactRole" name="editContactRole">
                        <option value="manager">üëî Manager</option>
                        <option value="admin">‚öôÔ∏è Administrateur</option>
                        <option value="commercial">üíº Commercial</option>
                        <option value="employee">üë§ Employ√©</option>
                        <option value="other">üìã Autre</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editPriority">Priorit√© des notifications</label>
                    <select id="editPriority" name="editPriority">
                        <option value="normal">üîµ Normale</option>
                        <option value="urgent">üî¥ Urgente</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="editActiveByDefault" name="editActiveByDefault">
                        Notifications activ√©es
                    </label>
                </div>

                <button type="submit" class="btn">üíæ Sauvegarder les modifications</button>
            </form>
        </div>
    </div>
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üë§ Nouveau contact</h3>
                <span class="close" onclick="closeContactModal()">&times;</span>
            </div>
            
            <form id="contactForm">
                <div class="form-group">
                    <label for="contactType">Type de contact</label>
                    <select id="contactType" name="contactType" onchange="toggleContactFields()">
                        <option value="email">üìß Email</option>
                        <option value="sms">üì± SMS</option>
                        <option value="both">üìßüì± Email + SMS</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="contactName">Nom complet</label>
                    <input type="text" id="contactName" name="contactName" placeholder="Ex: Sophie Martin" required>
                </div>

                <div class="form-group" id="emailField">
                    <label for="contactEmail">Adresse email</label>
                    <input type="email" id="contactEmail" name="contactEmail" placeholder="sophie.martin@exemple.fr" required>
                </div>

                <div class="form-group" id="smsField" style="display:none;">
                    <label for="contactPhone">Num√©ro de t√©l√©phone</label>
                    <input type="tel" id="contactPhone" name="contactPhone" placeholder="+33 6 12 34 56 78">
                </div>

                <div class="form-group">
                    <label for="contactRole">R√¥le</label>
                    <select id="contactRole" name="contactRole">
                        <option value="manager">üëî Manager</option>
                        <option value="admin">‚öôÔ∏è Administrateur</option>
                        <option value="commercial">üíº Commercial</option>
                        <option value="employee">üë§ Employ√©</option>
                        <option value="other">üìã Autre</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="priority">Priorit√© des notifications</label>
                    <select id="priority" name="priority">
                        <option value="normal">üîµ Normale</option>
                        <option value="urgent">üî¥ Urgente</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="activeByDefault" name="activeByDefault" checked>
                        Activer les notifications par d√©faut
                    </label>
                </div>

                <button type="submit" class="btn">‚úÖ Ajouter le contact</button>
            </form>
        </div>
    </div>

    <!-- Firebase -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, getDoc, serverTimestamp, query, orderBy } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAtZUiFPFrqU-PiMpIOrPIwrjJLv_NsKRU",
            authDomain: "gestion-affichage-publicitaire.firebaseapp.com",
            projectId: "gestion-affichage-publicitaire",
            storageBucket: "gestion-affichage-publicitaire.firebasestorage.app",
            messagingSenderId: "715445646165",
            appId: "1:715445646165:web:4da37e196e6a772f0735dc"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Variables globales
        window.firebaseAuth = auth;
        window.firebaseDB = db;
        window.currentUser = null;

        // V√©rifier l'√©tat de connexion
        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.currentUser = user;
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                loadAllData();
            } else {
                window.currentUser = null;
                document.getElementById('loginModal').style.display = 'block';
                document.getElementById('appContainer').style.display = 'none';
            }
        });

        // Connexion utilisateur
        async function loginUser() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
                document.getElementById('loginError').style.display = 'none';
            } catch (error) {
                document.getElementById('loginError').textContent = 'Erreur de connexion : ' + error.message;
                document.getElementById('loginError').style.display = 'block';
            }
        }

        // D√©connexion utilisateur
        async function logoutUser() {
            try {
                await signOut(auth);
            } catch (error) {
                console.error('Erreur d√©connexion:', error);
            }
        }

        // Charger toutes les donn√©es
        async function loadAllData() {
            await loadAffiches();
            await loadContacts();
            setTimeout(() => {
                setupSearch();
                setupFilters();
            }, 100);
        }

        // Charger les affiches
        async function loadAffiches() {
            try {
                const q = query(collection(db, 'affiches'), orderBy('dateCreation', 'desc'));
                const querySnapshot = await getDocs(q);
                const affiches = [];
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    if (data.dateCreation && data.dateCreation.toDate) {
                        data.dateCreation = data.dateCreation.toDate();
                    }
                    affiches.push({ id: doc.id, ...data });
                });
                
                displayAffiches(affiches);
                console.log('Affiches charg√©es:', affiches.length);
            } catch (error) {
                console.error('Erreur chargement affiches:', error);
                showErrorMessage('Erreur lors du chargement des affiches');
            }
        }

        // Charger les contacts
        async function loadContacts() {
            try {
                // Charger contacts email
                const emailQuery = query(collection(db, 'contacts_email'), orderBy('nom', 'asc'));
                const emailSnapshot = await getDocs(emailQuery);
                const contactsEmail = [];
                
                emailSnapshot.forEach((doc) => {
                    const data = doc.data();
                    if (data.dateCreation && data.dateCreation.toDate) {
                        data.dateCreation = data.dateCreation.toDate();
                    }
                    contactsEmail.push({ id: doc.id, ...data });
                });
                
                // Charger contacts SMS
                const smsQuery = query(collection(db, 'contacts_sms'), orderBy('nom', 'asc'));
                const smsSnapshot = await getDocs(smsQuery);
                const contactsSMS = [];
                
                smsSnapshot.forEach((doc) => {
                    const data = doc.data();
                    if (data.dateCreation && data.dateCreation.toDate) {
                        data.dateCreation = data.dateCreation.toDate();
                    }
                    contactsSMS.push({ id: doc.id, ...data });
                });
                
                displayContacts(contactsEmail, contactsSMS);
                console.log('Contacts charg√©s:', contactsEmail.length + contactsSMS.length);
            } catch (error) {
                console.error('Erreur chargement contacts:', error);
                showErrorMessage('Erreur lors du chargement des contacts');
            }
        }

        // Sauvegarder une affiche
        async function saveAffiche(affiche) {
            try {
                const docRef = await addDoc(collection(db, 'affiches'), {
                    ...affiche,
                    dateCreation: serverTimestamp(),
                    utilisateurId: window.currentUser.uid
                });
                console.log('Affiche sauv√©e avec ID:', docRef.id);
                await loadAffiches();
                return docRef.id;
            } catch (error) {
                console.error('Erreur sauvegarde affiche:', error);
                throw error;
            }
        }

        // Sauvegarder un contact
        async function saveContact(contact, type) {
            try {
                const collectionName = type === 'email' ? 'contacts_email' : 'contacts_sms';
                const docRef = await addDoc(collection(db, collectionName), {
                    ...contact,
                    dateCreation: serverTimestamp(),
                    utilisateurId: window.currentUser.uid
                });
                console.log('Contact sauv√© avec ID:', docRef.id);
                await loadContacts();
                return docRef.id;
            } catch (error) {
                console.error('Erreur sauvegarde contact:', error);
                throw error;
            }
        }

        // Supprimer une affiche
        async function deleteAffiche(id) {
            try {
                await deleteDoc(doc(db, 'affiches', id));
                showSuccessMessage('üóëÔ∏è Affiche supprim√©e avec succ√®s');
                await loadAffiches();
            } catch (error) {
                console.error('Erreur suppression affiche:', error);
                showErrorMessage('‚ùå Erreur lors de la suppression');
            }
        }

        // Supprimer un contact
        async function deleteContact(id, type) {
            try {
                const collectionName = type === 'email' ? 'contacts_email' : 'contacts_sms';
                await deleteDoc(doc(db, collectionName, id));
                showSuccessMessage('üóëÔ∏è Contact supprim√© avec succ√®s');
                await loadContacts();
            } catch (error) {
                console.error('Erreur suppression contact:', error);
                showErrorMessage('‚ùå Erreur lors de la suppression');
            }
        }

        // Fonction pour activer/d√©sactiver les notifications d'un contact
        async function toggleContactNotifications(contactId, type, isActive) {
            try {
                const collectionName = type === 'email' ? 'contacts_email' : 'contacts_sms';
                const docRef = doc(db, collectionName, contactId);
                await updateDoc(docRef, {
                    actif: isActive
                });
                console.log(`Notifications ${isActive ? 'activ√©es' : 'd√©sactiv√©es'} pour le contact ${contactId}`);
            } catch (error) {
                console.error('Erreur mise √† jour contact:', error);
                showErrorMessage('Erreur lors de la mise √† jour des notifications');
            }
        }

        // Fonctions d'affichage
        function displayAffiches(affiches) {
            updateDashboardStats(affiches);
            updateDashboardAffiches(affiches);
            updateAffichesTab(affiches);
        }

        function displayContacts(contactsEmail, contactsSMS) {
            updateEmailContacts(contactsEmail);
            updateSMSContacts(contactsSMS);
        }

        // Mettre √† jour les statistiques du dashboard
        function updateDashboardStats(affiches) {
            const stats = {
                enDiffusion: affiches.filter(a => a.statut === 'en-diffusion').length,
                aCreer: affiches.filter(a => a.statut === 'a-creer').length,
                programmees: affiches.filter(a => a.statut === 'programmee').length,
                archivees: affiches.filter(a => a.statut === 'archivee').length
            };
            
            const statCards = document.querySelectorAll('.stat-card h3');
            if (statCards.length >= 4) {
                statCards[0].textContent = stats.enDiffusion;
                statCards[1].textContent = stats.aCreer;
                statCards[2].textContent = stats.programmees;
                statCards[3].textContent = stats.archivees;
            }
        }

        // Mettre √† jour les affiches en diffusion sur le dashboard
        function updateDashboardAffiches(affiches) {
            const affichesEnDiffusion = affiches.filter(a => a.statut === 'en-diffusion').slice(0, 5);
            const container = document.querySelector('.recent-items');
            
            if (container) {
                if (affichesEnDiffusion.length === 0) {
                    container.innerHTML = `
                        <h3>üì∫ Affiches en diffusion</h3>
                        <div class="empty-state">
                            Aucune affiche en diffusion pour le moment
                        </div>
                    `;
                    return;
                }

                const itemsHtml = affichesEnDiffusion.map(affiche => {
                    const iconClass = getFamilleIconClass(affiche.famille);
                    const icon = getFamilleIcon(affiche.famille);
                    const dateExpiration = formatDate(affiche.dateFin);
                    
                    return `
                        <div class="item">
                            <div class="item-icon ${iconClass}">${icon}</div>
                            <div class="item-info">
                                <h4>${affiche.libelle}</h4>
                                <p>${affiche.prix}‚Ç¨/${affiche.unite} ‚Ä¢ ${affiche.origine} ‚Ä¢ Expire le ${dateExpiration}</p>
                            </div>
                            <span class="status-badge status-en-diffusion">En diffusion</span>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = `
                    <h3>üì∫ Affiches en diffusion</h3>
                    ${itemsHtml}
                `;
            }
        }

        // Mettre √† jour l'onglet Affiches
        function updateAffichesTab(affiches) {
            const container = document.querySelector('#affiches');
            if (!container) return;
            
            const searchBar = container.querySelector('.search-bar');
            const filterSection = container.querySelector('.filter-section');
            
            if (affiches.length === 0) {
                container.innerHTML = '';
                if (searchBar) container.appendChild(searchBar);
                if (filterSection) container.appendChild(filterSection);
                container.insertAdjacentHTML('beforeend', `
                    <div class="empty-state">
                        Aucune affiche cr√©√©e pour le moment.<br>
                        Cliquez sur le bouton + pour cr√©er votre premi√®re affiche !
                    </div>
                `);
                return;
            }
            
            const affichesHtml = affiches.map(affiche => {
                const iconClass = getFamilleIconClass(affiche.famille);
                const icon = getFamilleIcon(affiche.famille);
                const statusClass = getStatusClass(affiche.statut);
                const statusText = getStatusText(affiche.statut);
                const dateDebut = formatDate(affiche.dateDebut);
                const dateFin = formatDate(affiche.dateFin);
                
                return `
                    <div class="item" data-status="${affiche.statut}">
                        <div class="item-icon ${iconClass}">${icon}</div>
                        <div class="item-info">
                            <h4>${affiche.libelle}</h4>
                            <p>${affiche.prix}‚Ç¨/${affiche.unite} ‚Ä¢ ${affiche.origine}</p>
                            <p class="item-dates">${dateDebut} ‚Üí ${dateFin}</p>
                        </div>
                        <div class="item-actions">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                            <div class="item-actions-buttons">
                                <button class="action-btn edit-btn" onclick="editAffiche('${affiche.id}')">‚úèÔ∏è</button>
                                <button class="action-btn delete-btn" onclick="confirmDeleteAffiche('${affiche.id}', '${affiche.libelle}')">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = '';
            if (searchBar) container.appendChild(searchBar);
            if (filterSection) container.appendChild(filterSection);
            container.insertAdjacentHTML('beforeend', affichesHtml);
            
            setTimeout(() => {
                setupFilters();
                setupSearch();
            }, 50);
        }

        // Mettre √† jour la section contacts email
        function updateEmailContacts(contacts) {
            const container = document.querySelector('#emails-section .contacts-list');
            if (!container) return;
            
            if (contacts.length === 0) {
                container.innerHTML = `<div class="empty-state">Aucun contact email configur√©</div>`;
                return;
            }
            
            const contactsHtml = contacts.map(contact => {
                const roleClass = getRoleClass(contact.role);
                const roleText = getRoleText(contact.role);
                const prioriteClass = contact.priorite === 'urgent' ? 'tag-urgent' : '';
                const prioriteText = contact.priorite === 'urgent' ? 'Urgent' : '';
                const isChecked = contact.actif ? 'checked' : '';
                
                return `
                    <div class="contact-item">
                        <div class="contact-icon">üë§</div>
                        <div class="contact-info">
                            <h4>${contact.nom}</h4>
                            <p>${contact.email}</p>
                            <div class="contact-tags">
                                <span class="tag ${roleClass}">${roleText}</span>
                                ${prioriteText ? `<span class="tag ${prioriteClass}">${prioriteText}</span>` : ''}
                            </div>
                        </div>
                        <div class="contact-actions">
                            <label class="toggle">
                                <input type="checkbox" ${isChecked} onchange="toggleContactNotifications('${contact.id}', 'email', this.checked)">
                                <span class="slider"></span>
                            </label>
                            <button class="action-btn edit-btn" onclick="editContact('${contact.id}', 'email')">‚úèÔ∏è</button>
                            <button class="action-btn delete-btn" onclick="confirmDeleteContact('${contact.id}', '${contact.nom}', 'email')">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = contactsHtml;
        }

        // Mettre √† jour la section contacts SMS
        function updateSMSContacts(contacts) {
            const container = document.querySelector('#sms-section .contacts-list');
            if (!container) return;
            
            if (contacts.length === 0) {
                container.innerHTML = `<div class="empty-state">Aucun contact SMS configur√©</div>`;
                return;
            }
            
            const contactsHtml = contacts.map(contact => {
                const roleClass = getRoleClass(contact.role);
                const roleText = getRoleText(contact.role);
                const prioriteClass = contact.priorite === 'urgent' ? 'tag-urgent' : '';
                const prioriteText = contact.priorite === 'urgent' ? 'Urgent' : '';
                const isChecked = contact.actif ? 'checked' : '';
                
                return `
                    <div class="contact-item">
                        <div class="contact-icon">üì±</div>
                        <div class="contact-info">
                            <h4>${contact.nom}</h4>
                            <p>${contact.telephone}</p>
                            <div class="contact-tags">
                                <span class="tag ${roleClass}">${roleText}</span>
                                ${prioriteText ? `<span class="tag ${prioriteClass}">${prioriteText}</span>` : ''}
                            </div>
                        </div>
                        <div class="contact-actions">
                            <label class="toggle">
                                <input type="checkbox" ${isChecked} onchange="toggleContactNotifications('${contact.id}', 'sms', this.checked)">
                                <span class="slider"></span>
                            </label>
                            <button class="action-btn edit-btn" onclick="editContact('${contact.id}', 'sms')">‚úèÔ∏è</button>
                            <button class="action-btn delete-btn" onclick="confirmDeleteContact('${contact.id}', '${contact.nom}', 'sms')">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = contactsHtml;
        }

        // Fonctions utilitaires
        function getFamilleIconClass(famille) {
            const mapping = {
                'fruits-legumes': 'category-fruits',
                'traiteur': 'category-traiteur',
                'boucherie': 'category-boucherie',
                'cremerie': 'category-cremerie',
                'epicerie': 'category-epicerie',
                'boulangerie': 'category-boulangerie',
                'autre': 'category-autre'
            };
            return mapping[famille] || 'category-autre';
        }

        function getFamilleIcon(famille) {
            const mapping = {
                'fruits-legumes': 'üçé',
                'traiteur': 'ü•ò',
                'boucherie': 'ü•©',
                'cremerie': 'üßÄ',
                'epicerie': 'üõí',
                'boulangerie': 'ü•ñ',
                'autre': 'üì¶'
            };
            return mapping[famille] || 'üì¶';
        }

        function getStatusClass(statut) {
            return `status-${statut}`;
        }

        function getStatusText(statut) {
            const mapping = {
                'a-creer': '√Ä cr√©er',
                'programmee': 'Programm√©e',
                'en-diffusion': 'En diffusion',
                'archivee': 'Archiv√©e'
            };
            return mapping[statut] || 'Inconnu';
        }

        function getRoleClass(role) {
            return `tag-${role}`;
        }

        function getRoleText(role) {
            const mapping = {
                'manager': 'Manager',
                'admin': 'Admin',
                'commercial': 'Commercial',
                'employee': 'Employ√©',
                'other': 'Autre'
            };
            return mapping[role] || 'Autre';
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR', { 
                day: '2-digit', 
                month: '2-digit'
            });
        }

        // Messages toast
        function showErrorMessage(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ff4444;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                z-index: 9999;
                font-size: 14px;
                max-width: 300px;
                animation: slideIn 0.3s ease-out;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 5000);
        }

        function showSuccessMessage(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                z-index: 9999;
                font-size: 14px;
                max-width: 300px;
                animation: slideIn 0.3s ease-out;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Fonctions de confirmation
        function confirmDeleteAffiche(id, libelle) {
            if (confirm(`üóëÔ∏è √ätes-vous s√ªr de vouloir supprimer l'affiche :\n"${libelle}" ?\n\nCette action est irr√©versible.`)) {
                deleteAffiche(id);
            }
        }

        function confirmDeleteContact(id, nom, type) {
            const typeText = type === 'email' ? 'email' : 'SMS';
            if (confirm(`üóëÔ∏è √ätes-vous s√ªr de vouloir supprimer le contact ${typeText} :\n"${nom}" ?\n\nCette action est irr√©versible.`)) {
                deleteContact(id, type);
            }
        }

        // Variables globales pour l'√©dition
        window.currentEditingAffiche = null;
        window.currentEditingContact = null;

        // Mettre √† jour une affiche
        async function updateAffiche(id, data) {
            try {
                const docRef = doc(db, 'affiches', id);
                await updateDoc(docRef, {
                    ...data,
                    dateModification: serverTimestamp()
                });
                showSuccessMessage('‚úÖ Affiche mise √† jour avec succ√®s');
                await loadAffiches();
                return true;
            } catch (error) {
                console.error('Erreur mise √† jour affiche:', error);
                showErrorMessage('‚ùå Erreur lors de la mise √† jour');
                return false;
            }
        }

        // Mettre √† jour un contact
        async function updateContact(id, data, type) {
            try {
                const collectionName = type === 'email' ? 'contacts_email' : 'contacts_sms';
                const docRef = doc(db, collectionName, id);
                await updateDoc(docRef, {
                    ...data,
                    dateModification: serverTimestamp()
                });
                showSuccessMessage('‚úÖ Contact mis √† jour avec succ√®s');
                await loadContacts();
                return true;
            } catch (error) {
                console.error('Erreur mise √† jour contact:', error);
                showErrorMessage('‚ùå Erreur lors de la mise √† jour');
                return false;
            }
        }

        // Charger une affiche pour √©dition
        async function loadAfficheForEdit(id) {
            try {
                const docRef = doc(db, 'affiches', id);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const affiche = { id: docSnap.id, ...docSnap.data() };
                    window.currentEditingAffiche = affiche;
                    return affiche;
                } else {
                    showErrorMessage('‚ùå Affiche non trouv√©e');
                    return null;
                }
            } catch (error) {
                console.error('Erreur chargement affiche:', error);
                showErrorMessage('‚ùå Erreur lors du chargement');
                return null;
            }
        }

        // Charger un contact pour √©dition
        async function loadContactForEdit(id, type) {
            try {
                const collectionName = type === 'email' ? 'contacts_email' : 'contacts_sms';
                const docRef = doc(db, collectionName, id);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const contact = { id: docSnap.id, type: type, ...docSnap.data() };
                    window.currentEditingContact = contact;
                    return contact;
                } else {
                    showErrorMessage('‚ùå Contact non trouv√©');
                    return null;
                }
            } catch (error) {
                console.error('Erreur chargement contact:', error);
                showErrorMessage('‚ùå Erreur lors du chargement');
                return null;
            }
        }

        // Fonctions d'√©dition (maintenant fonctionnelles)
        async function editAffiche(id) {
            const affiche = await loadAfficheForEdit(id);
            if (!affiche) return;
            
            // Pr√©-remplir le formulaire
            document.getElementById('editAfficheId').value = affiche.id;
            document.getElementById('editLibelle').value = affiche.libelle || '';
            document.getElementById('editFamille').value = affiche.famille || '';
            document.getElementById('editPrix').value = affiche.prix || '';
            document.getElementById('editUnite').value = affiche.unite || 'kg';
            document.getElementById('editOrigine').value = affiche.origine || '';
            document.getElementById('editStatut').value = affiche.statut || 'a-creer';
            
            // G√©rer les dates
            if (affiche.dateDebut) {
                const dateDebut = new Date(affiche.dateDebut);
                document.getElementById('editDateDebut').value = dateDebut.toISOString().split('T')[0];
            }
            if (affiche.dateFin) {
                const dateFin = new Date(affiche.dateFin);
                document.getElementById('editDateFin').value = dateFin.toISOString().split('T')[0];
            }
            
            // Ouvrir le modal
            document.getElementById('editModal').style.display = 'block';
        }

        async function editContact(id, type) {
            const contact = await loadContactForEdit(id, type);
            if (!contact) return;
            
            // Pr√©-remplir le formulaire
            document.getElementById('editContactId').value = contact.id;
            document.getElementById('editContactType').value = type;
            document.getElementById('editContactName').value = contact.nom || '';
            document.getElementById('editContactRole').value = contact.role || 'employee';
            document.getElementById('editPriority').value = contact.priorite || 'normal';
            document.getElementById('editActiveByDefault').checked = contact.actif || false;
            
            // G√©rer les champs sp√©cifiques au type
            const emailField = document.getElementById('editEmailField');
            const smsField = document.getElementById('editSmsField');
            const emailInput = document.getElementById('editContactEmail');
            const smsInput = document.getElementById('editContactPhone');
            
            if (type === 'email') {
                emailField.style.display = 'block';
                smsField.style.display = 'none';
                emailInput.value = contact.email || '';
                emailInput.required = true;
                smsInput.required = false;
            } else {
                emailField.style.display = 'none';
                smsField.style.display = 'block';
                smsInput.value = contact.telephone || '';
                emailInput.required = false;
                smsInput.required = true;
            }
            
            // Ouvrir le modal
            document.getElementById('editContactModal').style.display = 'block';
        }

        // Fonctions pour fermer les modals d'√©dition
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            window.currentEditingAffiche = null;
        }

        function closeEditContactModal() {
            document.getElementById('editContactModal').style.display = 'none';
            window.currentEditingContact = null;
        }

        // Exposer les nouvelles fonctions
        window.updateAffiche = updateAffiche;
        window.updateContact = updateContact;
        window.loadAfficheForEdit = loadAfficheForEdit;
        window.loadContactForEdit = loadContactForEdit;
        window.editAffiche = editAffiche;
        window.editContact = editContact;
        window.closeEditModal = closeEditModal;
        window.closeEditContactModal = closeEditContactModal;

        // Fonction de recherche
        function setupSearch() {
            const affichesSearch = document.querySelector('#affiches .search-bar input');
            if (affichesSearch) {
                affichesSearch.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const items = document.querySelectorAll('#affiches .item');
                    
                    items.forEach(item => {
                        const title = item.querySelector('h4').textContent.toLowerCase();
                        const description = item.querySelector('p').textContent.toLowerCase();
                        
                        if (title.includes(searchTerm) || description.includes(searchTerm)) {
                            item.style.display = 'flex';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            }

            const emailSearch = document.querySelector('#email-search');
            if (emailSearch) {
                emailSearch.addEventListener('input', function(e) {
                    filterContacts(e.target.value, '#emails-section .contact-item');
                });
            }
            
            const smsSearch = document.querySelector('#sms-search');
            if (smsSearch) {
                smsSearch.addEventListener('input', function(e) {
                    filterContacts(e.target.value, '#sms-section .contact-item');
                });
            }
        }

        function filterContacts(searchTerm, selector) {
            const term = searchTerm.toLowerCase();
            const contacts = document.querySelectorAll(selector);
            
            contacts.forEach(contact => {
                const name = contact.querySelector('h4').textContent.toLowerCase();
                const email = contact.querySelector('p').textContent.toLowerCase();
                
                if (name.includes(term) || email.includes(term)) {
                    contact.style.display = 'flex';
                } else {
                    contact.style.display = 'none';
                }
            });
        }

        // Fonction de filtrage
        function setupFilters() {
            document.querySelectorAll('.filter-btn-affiches').forEach(btn => {
                btn.addEventListener('click', function() {
                    const filterValue = this.dataset.filter;
                    filterAffiches(filterValue);
                });
            });
        }

        function filterAffiches(status) {
            const items = document.querySelectorAll('#affiches .item');
            const filterBtns = document.querySelectorAll('.filter-btn-affiches');
            
            filterBtns.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.filter-btn-affiches[data-filter="${status}"]`).classList.add('active');
            
            items.forEach(item => {
                if (status === 'all' || item.dataset.status === status) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });
        }

        // Exposer les fonctions globalement
        window.loginUser = loginUser;
        window.logoutUser = logoutUser;
        window.saveAffiche = saveAffiche;
        window.saveContact = saveContact;
        window.deleteAffiche = deleteAffiche;
        window.deleteContact = deleteContact;
        window.toggleContactNotifications = toggleContactNotifications;
        window.showErrorMessage = showErrorMessage;
        window.showSuccessMessage = showSuccessMessage;
        window.confirmDeleteAffiche = confirmDeleteAffiche;
        window.confirmDeleteContact = confirmDeleteContact;
        window.editAffiche = editAffiche;
        window.editContact = editContact;
    </script>

    <script>
        // Fonctions de l'interface
        function showTab(tabName) {
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.closest('.tab').classList.add('active');
        }

        function openModal() {
            document.getElementById('createModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('createModal').style.display = 'none';
        }

        function openContactModal() {
            document.getElementById('contactModal').style.display = 'block';
        }

        function closeContactModal() {
            document.getElementById('contactModal').style.display = 'none';
        }

        function toggleContactFields() {
            const type = document.getElementById('contactType').value;
            const emailField = document.getElementById('emailField');
            const smsField = document.getElementById('smsField');
            const emailInput = document.getElementById('contactEmail');
            const smsInput = document.getElementById('contactPhone');
            
            if (type === 'email') {
                emailField.style.display = 'block';
                smsField.style.display = 'none';
                emailInput.required = true;
                smsInput.required = false;
            } else if (type === 'sms') {
                emailField.style.display = 'none';
                smsField.style.display = 'block';
                emailInput.required = false;
                smsInput.required = true;
            } else {
                emailField.style.display = 'block';
                smsField.style.display = 'block';
                emailInput.required = true;
                smsInput.required = true;
            }
        }

        // Fermer modals en cliquant dehors
        window.onclick = function(event) {
            const createModal = document.getElementById('createModal');
            const contactModal = document.getElementById('contactModal');
            const editModal = document.getElementById('editModal');
            const editContactModal = document.getElementById('editContactModal');
            
            if (event.target == createModal) {
                createModal.style.display = 'none';
            }
            if (event.target == contactModal) {
                contactModal.style.display = 'none';
            }
            if (event.target == editModal) {
                closeEditModal();
            }
            if (event.target == editContactModal) {
                closeEditContactModal();
            }
        }

        // Navigation planning
        let currentWeekStart = new Date(2025, 6, 8);

        function changeWeek(direction) {
            currentWeekStart.setDate(currentWeekStart.getDate() + (direction * 7));
            updateWeekHeader();
        }

        function updateWeekHeader() {
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            const months = [
                'Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin',
                'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'
            ];
            
            const startDay = currentWeekStart.getDate();
            const endDay = weekEnd.getDate();
            const month = months[currentWeekStart.getMonth()];
            const year = currentWeekStart.getFullYear();
            
            const weekRange = `${startDay} - ${endDay} ${month} ${year}`;
            document.getElementById('currentWeek').textContent = weekRange;
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // D√©finir les dates par d√©faut
            const today = new Date();
            const nextWeek = new Date();
            nextWeek.setDate(today.getDate() + 7);
            
            document.getElementById('dateDebut').valueAsDate = today;
            document.getElementById('dateFin').valueAsDate = nextWeek;

            // Initialiser les champs de contact
            toggleContactFields();

            // Event listener pour la connexion
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                window.loginUser();
            });

            // Event listener pour cr√©ation d'affiche
            document.getElementById('createForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const affiche = {
                    libelle: formData.get('libelle'),
                    famille: formData.get('famille'),
                    dateDebut: formData.get('dateDebut'),
                    dateFin: formData.get('dateFin'),
                    prix: parseFloat(formData.get('prix')),
                    unite: formData.get('unite'),
                    origine: formData.get('origine'),
                    statut: 'a-creer'
                };
                
                try {
                    await window.saveAffiche(affiche);
                    window.showSuccessMessage('üéâ Affiche cr√©√©e avec succ√®s!');
                    closeModal();
                    this.reset();
                    
                    // Remettre les dates par d√©faut
                    const today = new Date();
                    const nextWeek = new Date();
                    nextWeek.setDate(today.getDate() + 7);
                    document.getElementById('dateDebut').valueAsDate = today;
                    document.getElementById('dateFin').valueAsDate = nextWeek;
                } catch (error) {
                    window.showErrorMessage('‚ùå Erreur lors de la cr√©ation: ' + error.message);
                }
            });

            // Event listener pour cr√©ation de contact
            document.getElementById('contactForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const contact = {
                    nom: formData.get('contactName'),
                    role: formData.get('contactRole'),
                    priorite: formData.get('priority'),
                    actif: formData.get('activeByDefault') === 'on'
                };
                
                const type = formData.get('contactType');
                
                try {
                    if (type === 'email' || type === 'both') {
                        const contactEmail = {
                            ...contact,
                            email: formData.get('contactEmail')
                        };
                        await window.saveContact(contactEmail, 'email');
                    }
                    
                    if (type === 'sms' || type === 'both') {
                        const contactSMS = {
                            ...contact,
                            telephone: formData.get('contactPhone')
                        };
                        await window.saveContact(contactSMS, 'sms');
                    }
                    
                    window.showSuccessMessage(`üéâ Contact "${contact.nom}" ajout√© avec succ√®s!`);
                    closeContactModal();
                    this.reset();
                    toggleContactFields();
                } catch (error) {
                    window.showErrorMessage('‚ùå Erreur lors de l\'ajout: ' + error.message);
                }
            });

            // Event listener pour modification d'affiche
            document.getElementById('editForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const afficheId = formData.get('editAfficheId');
                
                const updatedData = {
                    libelle: formData.get('editLibelle'),
                    famille: formData.get('editFamille'),
                    dateDebut: formData.get('editDateDebut'),
                    dateFin: formData.get('editDateFin'),
                    prix: parseFloat(formData.get('editPrix')),
                    unite: formData.get('editUnite'),
                    origine: formData.get('editOrigine'),
                    statut: formData.get('editStatut')
                };
                
                try {
                    await window.updateAffiche(afficheId, updatedData);
                    closeEditModal();
                } catch (error) {
                    window.showErrorMessage('‚ùå Erreur lors de la modification: ' + error.message);
                }
            });

            // Event listener pour modification de contact
            document.getElementById('editContactForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const contactId = formData.get('editContactId');
                const contactType = formData.get('editContactType');
                
                const updatedData = {
                    nom: formData.get('editContactName'),
                    role: formData.get('editContactRole'),
                    priorite: formData.get('editPriority'),
                    actif: formData.get('editActiveByDefault') === 'on'
                };
                
                // Ajouter le champ sp√©cifique selon le type
                if (contactType === 'email') {
                    updatedData.email = formData.get('editContactEmail');
                } else {
                    updatedData.telephone = formData.get('editContactPhone');
                }
                
                try {
                    await window.updateContact(contactId, updatedData, contactType);
                    closeEditContactModal();
                } catch (error) {
                    window.showErrorMessage('‚ùå Erreur lors de la modification: ' + error.message);
                }
            });
            document.querySelectorAll('[data-notif-filter]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const filter = this.dataset.notifFilter;
                    
                    document.querySelectorAll('[data-notif-filter]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.notif-section').forEach(section => {
                        section.style.display = 'none';
                    });
                    document.getElementById(filter + '-section').style.display = 'block';
                });
            });
        });
    </script>
</body>
</html><!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Gestion Affichage Publicitaire</title>
    
    <!-- PWA Configuration -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Gestion Affichage">
    <meta name="theme-color" content="#667eea">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-logo {
            font-size: 20px;
        }

        .header h1 {
            font-size: 18px;
            margin: 0;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }

        .tab-icon {
            font-size: 18px;
        }

        .tab-text {
            font-size: 12px;
        }

        .tab-content {
            display: none;
            padding: 20px;
            height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 12px;
            opacity: 0.9;
        }

        .recent-items {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .recent-items h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }

        .item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: linear-gradient(135deg, #fef7ff 0%, #fdf2f8 100%);
            color: #333;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .item:nth-child(even) {
            background: linear-gradient(135deg, #f8faff 0%, #f1f5f9 100%);
        }

        .item-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 18px;
            color: white;
        }

        .item-info {
            flex: 1;
        }

        .item-info h4 {
            font-size: 14px;
            margin-bottom: 3px;
            color: #333;
        }

        .item-info p {
            font-size: 12px;
            color: #666;
        }

        .item-actions {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .item-actions-buttons {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .edit-btn {
            background: #e3f2fd;
            color: #1976d2;
        }

        .edit-btn:hover {
            background: #1976d2;
            color: white;
            transform: scale(1.1);
        }

        .delete-btn {
            background: #ffebee;
            color: #d32f2f;
        }

        .delete-btn:hover {
            background: #d32f2f;
            color: white;
            transform: scale(1.1);
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .status-a-creer {
            background: #fff3cd;
            color: #856404;
        }

        .status-programmee {
            background: #d4edda;
            color: #155724;
        }

        .status-en-diffusion {
            background: #cce5ff;
            color: #004085;
        }

        .status-archivee {
            background: #f8d7da;
            color: #721c24;
        }

        .category-fruits { background: #4CAF50; }
        .category-traiteur { background: #FF9800; }
        .category-boucherie { background: #F44336; }
        .category-cremerie { background: #2196F3; }
        .category-epicerie { background: #9C27B0; }
        .category-boulangerie { background: #FF5722; }
        .category-autre { background: #607D8B; }

        .search-bar {
            position: relative;
            margin-bottom: 20px;
        }

        .search-bar input {
            width: 100%;
            padding: 12px 40px 12px 12px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 14px;
        }

        .search-bar::after {
            content: "üîç";
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
        }

        .filter-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 20px;
        }

        .filter-section h4 {
            margin-bottom: 12px;
            font-size: 14px;
            color: #333;
        }

        .filter-buttons {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
            justify-content: flex-start;
        }

        .filter-btn, .filter-btn-affiches {
            padding: 6px 8px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: capitalize;
            white-space: nowrap;
        }

        .filter-btn.active, .filter-btn-affiches.active,
        .filter-btn:hover, .filter-btn-affiches:hover {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .item.hidden {
            display: none;
        }

        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .fab:hover {
            transform: scale(1.1);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 16px;
            border-radius: 12px;
            max-width: 90%;
            width: 350px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-header h3 {
            margin: 0;
            color: #333;
            font-size: 18px;
        }

        .close {
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #333;
            font-size: 13px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .alert-error {
            background: #ffebee;
            border: 1px solid #f8bbd9;
            color: #c62828;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: linear-gradient(135deg, #fef7ff 0%, #fdf2f8 100%);
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }

        .contact-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 18px;
        }

        .contact-info {
            flex: 1;
        }

        .contact-info h4 {
            font-size: 14px;
            margin: 0 0 3px 0;
            color: #333;
        }

        .contact-info p {
            font-size: 12px;
            color: #666;
            margin: 0 0 6px 0;
        }

        .contact-tags {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .tag {
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .tag-manager {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .tag-admin {
            background: #fff3e0;
            color: #ef6c00;
        }

        .tag-commercial {
            background: #e3f2fd;
            color: #1976d2;
        }

        .tag-urgent {
            background: #ffebee;
            color: #d32f2f;
        }

        .tag-employee {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .tag-other {
            background: #f5f5f5;
            color: #666;
        }

        .contact-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #667eea;
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        .notif-section {
            margin-top: 15px;
        }

        .contacts-list {
            margin-top: 15px;
        }

        .settings-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }

        .settings-card h4 {
            margin: 0 0 15px 0;
            font-size: 16px;
            color: #333;
        }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info h5 {
            margin: 0 0 4px 0;
            font-size: 14px;
            color: #333;
        }

        .setting-info p {
            margin: 0;
            font-size: 12px;
            color: #666;
        }

        /* Animations */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 20px;
        }

        #loginModal {
            z-index: 2000;
        }

        #loginModal .modal-content {
            width: 320px;
        }

        /* Planning styles */
        .agenda-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 0 10px;
        }

        .agenda-header h3 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }

        .nav-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: #667eea;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #5a67d8;
            transform: scale(1.1);
        }

        .alerts-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-dot {
            font-size: 12px;
        }

        .alert-text {
            font-size: 13px;
            color: #856404;
            font-weight: 500;
        }

        .agenda-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .agenda-day {
            background: white;
            border-radius: 10px;
            padding: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            border: 2px solid transparent;
        }

        .agenda-day.today {
            border-color: #667eea;
            background: linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%);
        }

        .day-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid #e9ecef;
        }

        .day-name {
            font-size: 15px;
            font-weight: 600;
            color: #333;
        }

        .day-date {
            font-size: 13px;
            color: #666;
        }

        .today-indicator {
            background: #667eea;
            color: white;
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
            margin-left: auto;
        }

        .day-events {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .event-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 6px;
            background: #f8f9fa;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .event-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
        }

        .event-content {
            flex: 1;
        }

        .event-content h4 {
            margin: 0 0 2px 0;
            font-size: 13px;
            color: #333;
        }

        .event-content p {
            margin: 0;
            font-size: 11px;
            color: #666;
        }

        .status-debut {
            background: #4CAF50;
            color: white;
        }

        .status-continue {
            background: #2196F3;
            color: white;
        }

        .status-termine {
            background: #FF5722;
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 10px 20px;
            margin-right: 10px;
        }

        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(108, 117, 125, 0.4);
        }

        .form-validation-error {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }

        .validation-message {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
            display: block;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .edit-indicator {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 8px 12px;
            margin-bottom: 15px;
            font-size: 13px;
            color: #856404;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media screen and (max-width: 420px) {
            .container {
                max-width: 100%;
                box-shadow: none;
            }
            
            .modal-content {
                width: 95%;
                max-width: 350px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Modal de connexion -->
    <div id="loginModal" class="modal" style="display:block;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîê Connexion</h3>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" name="loginEmail" required placeholder="test@exemple.com">
                </div>

                <div class="form-group">
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" name="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>

                <div id="loginError" class="alert-error" style="display:none;"></div>

                <button type="submit" class="btn">üîì Se connecter</button>
                
                <p style="margin-top: 15px; font-size: 12px; color: #666; text-align: center;">
                    Cr√©ez un compte dans la console Firebase ou utilisez un compte de test
                </p>
            </form>
        </div>
    </div>

    <!-- Application principale -->
    <div id="appContainer" class="container" style="display:none;">
        <div class="header">
            <div class="header-left">
                <div class="header-logo">üì∫</div>
                <h1>Gestion Affichage</h1>
            </div>
            <button onclick="logoutUser()" class="logout-btn">üö™ D√©connexion</button>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('dashboard')">
                <div class="tab-icon">üìä</div>
                <div class="tab-text">Dashboard</div>
            </div>
            <div class="tab" onclick="showTab('planning')">
                <div class="tab-icon">üìÖ</div>
                <div class="tab-text">Planning</div>
            </div>
            <div class="tab" onclick="showTab('affiches')">
                <div class="tab-icon">üìã</div>
                <div class="tab-text">Affiches</div>
            </div>
            <div class="tab" onclick="showTab('notifications')">
                <div class="tab-icon">üîî</div>
                <div class="tab-text">Notifs</div>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-stats">
                <div class="stat-card">
                    <h3>0</h3>
                    <p>En diffusion</p>
                </div>
                <div class="stat-card">
                    <h3>0</h3>
                    <p>√Ä cr√©er</p>
                </div>
                <div class="stat-card">
                    <h3>0</h3>
                    <p>Programm√©es</p>
                </div>
                <div class="stat-card">
                    <h3>0</h3>
                    <p>Archiv√©es</p>
                </div>
            </div>

            <div class="recent-items">
                <h3>üì∫ Affiches en diffusion</h3>
                <div class="empty-state">
                    Aucune affiche en diffusion pour le moment
                </div>
            </div>
        </div>

        <!-- Planning -->
        <div id="planning" class="tab-content">
            <div class="agenda-header">
                <button class="nav-btn" onclick="changeWeek(-1)">‚Äπ</button>
                <h3 id="currentWeek">8 - 14 Juillet 2025</h3>
                <button class="nav-btn" onclick="changeWeek(1)">‚Ä∫</button>
            </div>
            
            <div class="alerts-section">
                <div class="alert-item">
                    <span class="alert-dot">üî¥</span>
                    <span class="alert-text">Planning disponible apr√®s cr√©ation d'affiches</span>
                </div>
            </div>
            
            <div class="agenda-container">
                <div class="agenda-day today">
                    <div class="day-title">
                        <span class="day-name">Aujourd'hui</span>
                        <span class="today-indicator">Mercredi 10 Juillet</span>
                    </div>
                    <div class="day-events">
                        <div class="empty-state" style="padding: 20px;">
                            Aucun √©v√©nement programm√©
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Affiches -->
        <div id="affiches" class="tab-content">
            <div class="search-bar">
                <input type="text" placeholder="Rechercher une affiche...">
            </div>
            
            <div class="filter-section">
                <h4>üîç Filtrer par √©tat</h4>
                <div class="filter-buttons">
                    <button class="filter-btn-affiches active" data-filter="all">Tous</button>
                    <button class="filter-btn-affiches" data-filter="a-creer">√Ä cr√©er</button>
                    <button class="filter-btn-affiches" data-filter="programmee">Prog.</button>
                    <button class="filter-btn-affiches" data-filter="en-diffusion">Diff.</button>
                    <button class="filter-btn-affiches" data-filter="archivee">Archiv.</button>
                </div>
            </div>
            
            <div class="empty-state">
                Aucune affiche cr√©√©e pour le moment.<br>
                Cliquez sur le bouton + pour cr√©er votre premi√®re affiche !
            </div>
        </div>

        <!-- Notifications -->
        <div id="notifications" class="tab-content">
            <div class="filter-section">
                <h4>üîî Gestion des notifications</h4>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-notif-filter="emails">üìß Emails</button>
                    <button class="filter-btn" data-notif-filter="sms">üì± SMS</button>
                    <button class="filter-btn" data-notif-filter="settings">‚öôÔ∏è Config</button>
                </div>
            </div>

            <div id="emails-section" class="notif-section">
                <div class="search-bar">
                    <input type="text" id="email-search" placeholder="Rechercher un contact...">
                </div>
                
                <div class="contacts-list">
                    <div class="empty-state">
                        Aucun contact email configur√©
                    </div>
                </div>
            </div>

            <div id="sms-section" class="notif-section" style="display:none;">
                <div
